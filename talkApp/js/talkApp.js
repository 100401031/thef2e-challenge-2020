"use strict";var vm=new Vue({el:"#app",data:{inputLang:"en-US",currentGroup:{},msgRecognizing:!1,msgRecording:!1,autoSend:!1,tempMsg:{text:null,audioBlob:null,audioUrl:null,audioDuration:null},groups:[{id:"#1",title:"101 Airborne Division",messages:[]},{id:"#2",title:"Easy Company",messages:[]}]},watch:{currentGroup:function(){new Audio("./sound/channel.mp3").play()}},computed:{messages:function(){return this.currentGroup.messages.reverse()}},methods:{recordFn:function(){return{mediaRecorder:null,start:function(){var e=this;vm.msgRecording=!0,navigator.mediaDevices.getUserMedia({audio:!0}).then(function(t){e.mediaRecorder=new MediaRecorder(t),e.mediaRecorder.start();var i=Date.now(),r=[];e.mediaRecorder.addEventListener("dataavailable",function(t){r.push(t.data)}),e.mediaRecorder.addEventListener("stop",function(){var t=Date.now();vm.tempMsg.audioDuration=t-i;var e=new Blob(r),n=URL.createObjectURL(e);vm.tempMsg.audioBlob=e,vm.tempMsg.audioUrl=n,vm.autoSend&&vm.sendMsg()})})},end:function(){this.mediaRecorder.stop(),vm.msgRecording=!1}}},inputRecognition:function(){var r=this,t=t||webkitSpeechRecognition,o=(webkitSpeechGrammarList,webkitSpeechRecognitionEvent,new t);o.continuous=!0,o.interimResults=!0,o.lang=this.inputLang;var e=this.recordFn();o.start(),o.onstart=function(){e.start(),r.msgRecognizing=!0},o.onend=function(){e.end(),r.commandRecognition(),r.msgRecognizing=!1},o.onresult=function(t){for(var e="",n="",i=t.resultIndex;i<t.results.length;++i)t.results[i].isFinal?(n+=t.results[i][0].transcript,r.tempMsg.text=n,o.stop()):(e+=t.results[i][0].transcript,r.tempMsg.text=e)}},commandRecognition:function(){var o=this,t=t||webkitSpeechRecognition,e=e||webkitSpeechGrammarList,n=(webkitSpeechRecognitionEvent,"#JSGF V1.0; grammar commands; public <commands> = "+["switch to"].join(" | ")+" ;"),i=new t,r=new e;r.addFromString(n,1),i.grammars=r,i.lang="en-US",i.continuous=!0,i.interimResults=!1,i.maxAlternatives=1,i.start(),i.onend=function(){setTimeout(function(){o.msgRecording||o.commandRecognition()},50)},i.onresult=function(t){var e,n;o.msgRecognizing||(e=t.results.length-1,(n=t.results[e][0].transcript).toLowerCase().includes("switch to")&&function(t){var e;if(t.includes("channel")){var n=t.replace("switch to channel","").trim(),i=parseInt(n,10)-1;e=o.groups[i]}else{var r=t.replace("switch to","").trim();if(r==o.currentGroup.title)return;e=o.groups.find(function(t){return t.title.toLowerCase()==r})}e&&o.currentGroup!==e&&(o.currentGroup=e)}(n.toLowerCase()))}},sendMsg:function(t,e){var n=1<arguments.length&&void 0!==e?e:this.tempMsg;(n.text.length||n.audioUrl)&&(n.timestamp=Date.now(),this.currentGroup.messages.push(n),this.tempMsg={text:null,audioBlob:null,audioUrl:null,audioDuration:null})}},created:function(){this.currentGroup=this.groups[0],this.commandRecognition()},filters:{timeFormat:function(t){var e=new Date(t),n=e.getFullYear(),i=e.getMonth()+1,r=e.getDate(),o="0"+e.getHours(),s="0"+e.getMinutes(),a="0"+e.getSeconds();return"".concat(n,"-").concat(i,"-").concat(r," ").concat(o.substr(-2),":").concat(s.substr(-2),":").concat(a.substr(-2))}}});
//# sourceMappingURL=talkApp.js.map
