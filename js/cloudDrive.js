!function(e){var t={};function r(i){if(t[i])return t[i].exports;var o=t[i]={i:i,l:!1,exports:{}};return e[i].call(o.exports,o,o.exports,r),o.l=!0,o.exports}r.m=e,r.c=t,r.d=function(e,t,i){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(r.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)r.d(i,o,function(t){return e[t]}.bind(null,o));return i},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=0)}([function(e,t){function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var i;i=new Vue({el:"#app",data:{sidebarDropdownVisible:!1,fileNavDropdownVisible:!1,storage_size:5e6,storage_usage:0,searchInput:"",searchResult:[],dataStorage:{rootFolder:{id:"root",name:"我的雲端硬碟",editable:!0,modifiedTime:"",size:"",ownerId:"me",fileType:"folder",fileList:[{id:"#1-f",name:"Hello World!",editable:!0,isStar:!1,modifiedTime:1598047432044,size:"",ownerId:"me",fileType:"folder",childrenFolder:[],fileList:[],path:"/root"}],path:""},trash:{id:"trash",name:"垃圾桶",editable:!1,modifiedTime:"",size:"",ownerId:"me",fileType:"folder",fileList:[]},star:{id:"star",name:"已加星號",editable:!1,modifiedTime:"",size:"",ownerId:"me",fileType:"folder",fileList:[]}},starFileId:[],lastSection:null,currentSection:null,currentFolder:null,preFolderNav:[],folderNav:[],preventRecord:!1,dragoverItem:null,rightClickItem:null,isDraggingItem:null,newFolderName:"新文件夾",fileDropdownVisible:!1},computed:{displayfolderNav:function(){if(this.folderNav.length>3){var e=this.folderNav.slice(1,-1),t=[].concat(this.folderNav);return t.splice(1,this.folderNav.length-2,e),t}return this.folderNav},storeUsagePercentage:function(){return this.storage_usage/this.storage_size*100},displayFileList:function(){return this.currentFolder.fileList},searchFilter:function(){return""!=this.searchInput?this.searchFile(this.dataStorage.rootFolder,this.searchInput):[]}},watch:{currentFolder:{handler:function(e,t){var r=this;t&&!this.preventRecord&&("root"==e.id||"trash"==e.id||"search"==e.id||"star"==e.id?(this.folderNav=[],this.folderNav.push(e)):this.folderNav.push(e),e.editable?this.editableFolder=!0:this.editableFolder=!1),"root"!=e.id&&"trash"!=e.id&&"search"!=e.id&&"star"!=e.id||(t&&(this.lastSection=this.currentSection),this.currentSection=e.id),this.$nextTick((function(){r.lastSection&&$(".table_wrapper").removeClass(r.lastSection),$(".table_wrapper").addClass(r.currentSection)}))}},dragoverItem:function(){var e=this;this.$nextTick((function(){e.lastSection&&$(".table_wrapper").removeClass(e.lastSection),$(".table_wrapper").addClass(e.currentSection)}))},searchFilter:function(e){var t={id:"search",name:"搜尋結果",editable:!1,modifiedTime:"",size:"",ownerId:"me",fileType:"folder",fileList:e,path:""};this.currentFolder=t,""==this.searchInput&&(this.currentFolder=this.dataStorage.rootFolder)}},methods:{searchFile:function(e,t){var r=this,i=[];e.fileList.filter((function(e){return e.name.includes(t)})).forEach((function(e){i.push(e)}));var o=e.fileList.filter((function(e){return"folder"==e.fileType}));return o.length>0&&o.forEach((function(e){r.searchFile(e,t).forEach((function(e){i.push(e)}))})),i},filterStarFile:function(e){var t=this,r=[];e.fileList.filter((function(e){return!0===e.isStar})).forEach((function(e){r.push(e)}));var i=e.fileList.filter((function(e){return"folder"==e.fileType}));return i.length>0&&i.forEach((function(e){t.filterStarFile(e).forEach((function(e){r.push(e)}))})),r},handleClickOutside:function(e,t){var r=t.getAttribute("el-name");this["".concat(r,"Visible")]=!1},handleListItemDblClick:function(e){e.isInTrash||"folder"===e.fileType&&(this.currentFolder=e)},handleNavToFolder:function(e){if(e!==this.currentFolder){var t=this.folderNav.findIndex((function(t){return t.id==e.id}));this.folderNav.splice(t),this.preventRecord=!0,this.currentFolder=e,this.preventRecord=!1}},createFolder:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"新文件夾";this.sidebarDropdownVisible=!1;var t={id:this._creatUuid(),name:e,editable:!0,isStar:!1,modifiedTime:(new Date).getTime(),size:"",ownerId:"me",fileType:"folder",fileList:[],path:this.currentFolder.path+"/"+this.currentFolder.id};this.currentFolder.fileList.push(t),this.saveToLocalStorage(),this.newFolderName="新文件夾"},dragStart:function(e,t){this.currentFolder.editable&&(this.isDraggingItem=t,$(".table_wrapper").addClass("draggedTable"))},dragEnd:function(e,t){this.isDraggingItem=null,this.dragoverItem=null,$(".table_wrapper").removeClass("draggedTable")},dragOver:function(e){this.currentFolder.editable&&(this.dragoverItem||e.fileList.includes(this.isDraggingItem)||e==this.isDraggingItem||(this.dragoverItem=e))},dragLeave:function(){this.currentFolder.editable&&(this.dragoverItem=null)},drop:function(e,t){if(this.currentFolder.editable){var r=this.isDraggingItem,i=this.dragoverItem;if(r){if(r==i||!i)return;return this.moveDriveFile(r,i),void(i=null)}this.handleUploadFile(e.dataTransfer.files,t),this.dragoverItem=null}},uploadByInput:function(e){this.currentFolder.editable&&(this.handleUploadFile(e.target.files,this.currentFolder),this.sidebarDropdownVisible=!1)},handleUploadFile:function(e,t){for(var i=this,o=function(r){var o=e[r];return""==o.type?(alert("「".concat(o.name,"」格式錯誤，目前暫不支援上傳此種格式。")),{v:void 0}):o.size>3890704?(alert("「".concat(o.name,"」檔案太大囉，由於是存入localStorage，建議測試檔案小於3.8MB。")),{v:void 0}):void i.convertFile(o).then((function(e){var r=i._creatUuid(),a=o.name,n={id:r,name:a,isStar:!1,modifiedTime:o.lastModified,size:o.size,ownerId:"me",fileType:i.checkFileType(o.type),path:i.currentFolder.path+"/"+i.currentFolder.id};t.fileList.push(n),i.saveToLocal(e,r,a),i.storage_usage=.77*JSON.stringify(localStorage).length,i.saveToLocalStorage()})).catch((function(e){console.log("err",e)}))},a=0;a<e.length;a++){var n=o(a);if("object"===r(n))return n.v}},moveDriveFile:function(e,t){if("folder"!=e.fileType&&"folder"==t.fileType){var r=this.currentFolder.fileList.indexOf(e);t.fileList.push(e),this.currentFolder.fileList.splice(r,1),this.saveToLocalStorage()}else if("folder"==e.fileType&&"folder"==t.fileType){var i=this.currentFolder.fileList.indexOf(e);t.fileList.push(e),this.currentFolder.fileList.splice(i,1),this.saveToLocalStorage()}},checkFileType:function(e){return console.log(e),e.includes("mp4")?"mp4":e.includes("image")?"image":e.includes("msword")||e.includes("application/vnd.openxmlformats-officedocument.wordprocessingml.document")?"msword":e.includes("pdf")?"pdf":"default"},convertFile:function(e){return new Promise((function(t,r){var i=new FileReader;i.onload=function(){t(i.result)},i.onerror=function(){r(i.error)},i.readAsDataURL(e)}))},saveToLocal:function(e,t,r){var i={data:e,fileId:t,fileName:r},o=JSON.stringify(i);localStorage.setItem(t,o)},download:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.rightClickItem;if("trash"!=this.currentSection&&"folder"!=e.fileType){var t=JSON.parse(localStorage.getItem(e.id)),r=document.createElement("a");r.href=t.data,r.setAttribute("download",e.name),r.click()}},activeUploadInput:function(){"root"!=this.currentSection&&(this.currentFolder=this.dataStorage.rootFolder),this.$refs.fileInput.click()},moveToTrash:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.rightClickItem;if("trash"!=this.currentSection){e.isInTrash=!0,this.dataStorage.trash.fileList.push(e);var t=this.currentFolder.fileList.find((function(t){return t.id==e.id})),r=this.currentFolder.fileList.indexOf(t);this.currentFolder.fileList.splice(r,1),this.saveToLocalStorage(),this.saveToLocalTrash()}},deleteFile:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.rightClickItem,t=this.dataStorage.trash.fileList.indexOf(e);this.dataStorage.trash.fileList.splice(t,1),localStorage.removeItem(e.id),this.storage_usage=.77*JSON.stringify(localStorage).length,this.saveToLocalTrash()},recycleItem:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.rightClickItem;if("trash"==this.currentSection){var t,r=e.path.split("/");if(r.splice(0,2),0==r.length)t=this.dataStorage.rootFolder;else{for(var i=this.dataStorage.rootFolder,o=function(e){var t=i.fileList.find((function(t){return t.id==r[e]}));i=t},a=0;a<r.length;a++)o(a);t=i}e.isInTrash=!1,t.fileList.push(e);var n=this.dataStorage.trash.fileList.indexOf(e);this.dataStorage.trash.fileList.splice(n,1),this.saveToLocalStorage(),this.saveToLocalTrash()}},_creatUuid:function(){var e=Date.now();return"undefined"!=typeof performance&&"function"==typeof performance.now&&(e+=performance.now()),"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){var r=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"===t?r:3&r|8).toString(16)}))},fileContextMenu:function(e){this.rightClickItem=e},addStar:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.rightClickItem;if(e.isStar=!e.isStar,this.saveToLocalStorage(),this.saveToLocalTrash(),e.isStar)this.dataStorage.star.fileList.push(e);else{var t=this.dataStorage.star.fileList,r=t.find((function(t){return t.id==e.id})),i=t.indexOf(r);t.splice(i,1)}},starPage:function(){this.currentFolder=this.dataStorage.star},saveToLocalStorage:function(){var e=JSON.stringify(this.dataStorage.rootFolder.fileList);localStorage.setItem("myStorage",e)},saveToLocalTrash:function(){var e=JSON.stringify(this.dataStorage.trash.fileList);localStorage.setItem("myTrash",e)}},filters:{timeFormat:function(e){var t=new Date(e),r=t.getFullYear(),i=t.getMonth()+1,o=t.getDate(),a="0"+t.getHours(),n="0"+t.getMinutes(),l="0"+t.getSeconds();return"".concat(r,"-").concat(i,"-").concat(o," ").concat(a.substr(-2),":").concat(n.substr(-2),":").concat(l.substr(-2))},sizeFormat:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;if(isNaN(e)||!e)return"";if(0===e)return"0 Bytes";var r=1024,i=t<0?0:t,o=["Bytes","KB","MB","GB","TB","PB","EB","ZB","YB"],a=Math.floor(Math.log(e)/Math.log(r));return parseFloat((e/Math.pow(r,a)).toFixed(i))+" "+o[a]}},created:function(){this.currentFolder=this.dataStorage.rootFolder,this.folderNav.push(this.dataStorage.rootFolder),this.storage_usage=.77*JSON.stringify(localStorage).length;var e=this.filterStarFile(this.dataStorage.rootFolder);this.dataStorage.star.fileList=e;var t=JSON.parse(localStorage.getItem("myStorage"))||[{id:"#1-f",name:"Hello World!",editable:!0,isStar:!1,modifiedTime:1598047432044,size:"",ownerId:"me",fileType:"folder",childrenFolder:[],fileList:[],path:"/root"}],r=JSON.parse(localStorage.getItem("myTrash"))||[];this.dataStorage.rootFolder.fileList=t,this.dataStorage.trash.fileList=r},mounted:function(){},directives:{"click-outside":{bind:function(e,t,r){e.clickOutsideEvent=function(i){var o=e.getAttribute("el-name");e==i.target||e.contains(i.target)||o==i.target.getAttribute("bind-el")||r.context[t.expression](i,e)},document.body.addEventListener("click",e.clickOutsideEvent),document.body.addEventListener("contextmenu",e.clickOutsideEvent)},unbind:function(e){document.body.removeEventListener("click",e.clickOutsideEvent),document.body.removeEventListener("contextmenu",e.clickOutsideEvent)}}}}),$((function(){$.contextMenu({selector:".table_contextmenu.root",items:{upload:{name:"上傳檔案",callback:function(){i.activeUploadInput()}},createNewFolder:{name:"新增資料夾",callback:function(){$("#newFolderModal").modal("show")}}}})})),$((function(){$.contextMenu({selector:".table_contextmenu.root .folder_type",items:{star:{name:"標示星號",callback:function(){i.addStar()}},moveToTrash:{name:"移至垃圾桶",callback:function(){i.moveToTrash()}}}})})),$((function(){$.contextMenu({selector:".table_contextmenu.root .doc_type",items:{download:{name:"下載",callback:function(){i.download()}},star:{name:"標示星號",callback:function(){i.addStar()}},moveToTrash:{name:"移至垃圾桶",callback:function(){i.moveToTrash()}}}})})),$((function(){$.contextMenu({selector:".table_contextmenu.trash .doc_type , .table_contextmenu.trash .folder_type",items:{recycle:{name:"還原",callback:function(){i.recycleItem()}},delete:{name:"永久刪除",callback:function(){$("#deleteModal").modal("show")}}}})}))}]);
//# sourceMappingURL=cloudDrive.js.map